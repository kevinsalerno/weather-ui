{"version":3,"sources":["../../src/pages/forecast/forecast.module.ts","../../src/pages/forecast/forecast.ts"],"names":[],"mappings":"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","file":"0.js","sourcesContent":["import { NgModule } from '@angular/core';\nimport { IonicPageModule } from 'ionic-angular';\nimport { ForecastPage } from './forecast';\nimport { ComponentsModule } from '../../components/components.module';\n\n@NgModule({\n  declarations: [\n    ForecastPage,\n  ],\n  imports: [\n    ComponentsModule,\n    IonicPageModule.forChild(ForecastPage),\n  ],\n})\nexport class ForecastPageModule { }\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/forecast/forecast.module.ts","import { Component } from '@angular/core';\nimport { IonicPage, NavController, NavParams } from 'ionic-angular';\nimport { HttpProvider } from '../../providers/http/http';\nimport { isNumeric } from '../../shared';\nimport { StorageProvider } from '../../providers/storage/storage';\n\n/**\n * Generated class for the ForecastPage page.\n *\n * See https://ionicframework.com/docs/components/#navigation for more info on\n * Ionic pages and navigation.\n */\n\n@IonicPage({\n  segment: 'forecast/:search' // use a segment to pull URL relevant data eg. app.com/#/forecast/Denver\n})\n@Component({\n  selector: 'page-forecast',\n  templateUrl: 'forecast.html',\n})\nexport class ForecastPage {\n\n\n  search: any;\n  data: any = {};\n  dates: any = {};\n\n  constructor(public navCtrl: NavController, public navParams: NavParams, private api: HttpProvider,\n    private storage: StorageProvider) {\n  }\n\n  ionViewDidLoad() {\n\n  }\n\n  // use storage service to load cache key\n  loadCache(key) {\n    console.log(`getting cache for key ${key}`)\n    let cached = this.storage.get(key);\n    console.log(cached);\n    if (cached) {\n      console.log('success!');\n      return JSON.parse(cached);\n    }\n    return null;\n  }\n\n  setForecastData(data) {\n    this.data = data;\n    this.dates = this.getWeatherByDate(data.list);\n  }\n\n  // helper template function\n  getObjKeys(obj) {\n    return Object.keys(obj);\n  }\n\n  // sort hourly weather data into like-dates\n  getWeatherByDate(list) {\n    console.log('get item by date');\n    let dates = {};\n    list.forEach(item => {\n      if (item.dt_txt) {\n        let date = item.dt_txt.split(' ')[0];\n        if (!dates[date]) {\n          dates[date] = [];\n        }\n        dates[date].push(item);\n      }\n    });\n    return dates;\n  }\n\n  // Fire each time the view becomes active in the DOM\n  // Had some issues with Ionic routing and browser here - ideally would use Angular 5+ router events\n  ionViewWillEnter() {\n    console.log('SEARCH');\n    console.log(this.navParams.data);\n\n    this.search = this.navParams.get('search');\n\n    // get cache based on search string\n    let cached = this.loadCache(this.search);\n\n    if (cached) {\n      // if cache exists, skip the fetch and set the data\n      this.setForecastData(cached);\n    } else {\n\n      // pull params out of search string (is it zip or city?)\n      let params = (isNumeric(this.search) ? { zip: this.search } : { q: this.search })\n\n      // using nav parameters (old style)\n      // this.api.fetchForecast(this.navParams.data).subscribe(res => {\n\n\n      // fetch forecast with params object\n      this.api.fetchForecast(params).subscribe((res: any) => {\n        console.log(res);\n\n        if (res.cod === '200') {\n          // set data/save cache only if sucessful fetch\n          this.setForecastData(res);\n          this.storage.set(this.search, JSON.stringify(Object.assign({}, res, { fetchedAt: new Date() })));\n        }\n      }, err => {\n        throw err;\n      });\n    }\n\n  }\n\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/forecast/forecast.ts"],"sourceRoot":""}